from unittest import TestCase, main
import pandas as pd
from tempfile import mkstemp
from os import remove

import matplotlib.pyplot as plt
from skbio.util import get_data_path

from ggmap.snippets import (plot_diff_taxa, biom2pandas)
from ggmap.imgdiff import compare_images

plt.switch_backend('Agg')
plt.rc('font', family='DejaVu Sans')


class DiffTaxaTests(TestCase):
    def setUp(self):
        self.diffTaxa = {
            ('Bean', 'Control'):
            {'AAGCATGGGAAGTAGTTCTT86': 1, 'AAGCGGACGACGCGGGCAGA85': 1,
             'AAGGGTGTGGTCAATCGCGG74': 1, 'AAGTAATACTCCGGTTATAC33': 1,
             'ACCAGTTGCGTCCGGGGGAC178': 1, 'ACGTCAAAGGAGGACGTCAG130': 1,
             'ACGTCAAGGCACCCGCGGGA196': 1, 'ACTATGAGGCGTTTCCGGCC72': 1,
             'AGCGAGATAGGTTGCGGATC5': 1, 'AGGTGAGTAGATAAGTGTTT66': 1,
             'AGTACTCACAGGCGTCTTGA69': 1, 'AGTCAGGGCGGGGGGTCTTA139': 1,
             'AGTGACAACAAGACCATAGA30': 1, 'ATCTCAGAGTTGGTGAAGCA235': 1,
             'ATTATTTTCGAGTTGGGACT112': 1, 'CAAAATGGCAAGTTATATCA125': 1,
             'CACATCGGAACTCGCCGTAA89': 1, 'CCAGTATGAGGGTGGGGTGG42': 1,
             'CCCGATTCGGCTCCTAATGA40': 1, 'CGACGCGGGGCGGAAGAAGA46': 1,
             'CGAGGTGGGCGGGCTGTTTG52': 1, 'CGGGCGGATGAGCGTTACCA214': 1,
             'CGGGTCCCTCTAGTGTAGGA133': 1, 'CTCTAAGAACCGAAGCATAT23': 1,
             'GAACCCTAGGAGGTAACCAA206': 1, 'GAGACTAGGCCACGCCCCGG137': 1,
             'GAGTGTAGGTAGTCCATACT198': 1, 'GATAAGTGAAGTTCATTGGT174': 1,
             'GATAGGCGCGGGCACGTTTG122': 1, 'GCAAAATATAGACAGGAGCT215': 1,
             'GCCAGGAGTGCTCGGCGGGG210': 1, 'GCGTTCAGATATCTGGGTAG223': 1,
             'GCTGGATAATCACTGGGGGT218': 1, 'GGCAGGTGGTGGAGGCAGAT15': 1,
             'GGGATCGAACCTTATTTGGG175': 1, 'GGGCTAGGGAAGCCTGCCTC131': 1,
             'GGTAGAAACAAGGAATACCG77': 1, 'GGTGTCGAGGGCTATGTGCA109': 1,
             'GTAAATCGTAGGCGAGGAAA28': 1, 'GTAGCGTTCCGAGACTACCA153': 1,
             'GTCGTGCTCTCTGAGCAAAG48': 1, 'TAGGATGGGATCCTTATGGA117': 1,
             'TAGTATAGGGTGTTGGAATA38': 1, 'TATAGCCAGCGTGTCTCTTG184': 1,
             'TATATTTGAGAGATGAGGGG167': 1, 'TATGGTGCTAGACCACTTAT58': 1,
             'TATTATCAAGGAAGGCGGGG1': 1, 'TCAGATACTAGGCGCAACGC221': 1,
             'TCAGGTCCGTGAGTTTAGGC181': 1, 'TCTGGGGGGGTTTAGTCTTC229': 1,
             'TGCCATAGCCCCAAGGCTAT160': 1, 'TTTTCAGCTACGGTCAAAAG238': 1},
            ('Bean', 'Cowpea'):
            {'AACAGAGTCTGAGGCTACGT9': 1, 'AAGCCCTAATCGCGAGGGAG63': 1,
             'AAGTAATACTCCGGTTATAC33': 1, 'AATGGAAGGGGAAACAGAGG95': 1,
             'ACCAGTTGCGTCCGGGGGAC178': 1, 'ACGAGTGGGGATGGGGTGAT2': 1,
             'ACGTCAAGGCACCCGCGGGA196': 1, 'ACTGACCCTGAGGTTAAGTG158': 1,
             'ACTGTGTAAAGTACAGTGCG197': 1, 'AGAGCGCATTGGTTGGGCTA45': 1,
             'AGCTGGAGGTGTATAATAGC13': 1, 'AGGGGTTCGGGAACGTGTGA241': 1,
             'AGGTGAGTAGATAAGTGTTT66': 1, 'AGGTTTGATTGGTGCAACCT87': 1,
             'AGTACTCACAGGCGTCTTGA69': 1, 'ATGCAGCGCGCCTTCGCATT62': 1,
             'CAAAATGGCAAGTTATATCA125': 1, 'CAACAGGTGTCGAATGAGAA183': 1,
             'CACTAGGGGGCGGACAGCTA230': 1, 'CAGGATCAGCCTGACAATTT209': 1,
             'CAGGCTGGATAAGGGCATGG129': 1, 'CCAGTATGAGGGTGGGGTGG42': 1,
             'CCCTACTCCGGGAACAAGTA21': 1, 'CCGGATTGCGTATCGTGATG170': 1,
             'CCGTTAGGAACGGTACGTAT0': 1, 'CCTGGCAAGCATGAGTGTTT54': 1,
             'CGAACCTTAACGAAAGGGCA80': 1, 'CGACGCGGGGCGGAAGAAGA46': 1,
             'CGAGGTGGGCGGGCTGTTTG52': 1, 'CGCCCGGGACACATGTGTCG162': 1,
             'CGCTTGGATGGAGTCAGACG19': 1, 'CGGGGGTGCCTGCAATTTCC67': 1,
             'CTATTCTGTTCTGGGGGTAT17': 1, 'CTCTAAGAACCGAAGCATAT23': 1,
             'CTGAATGGCTGGGGTTACCC157': 1, 'CTTCTACCCGGTTGTACTTG195': 1,
             'GAAGTGGGCTTCGACAACTT99': 1, 'GAGATCGCTGGCGGAAACAT190': 1,
             'GAGGGCGCGGTATTATGCGA49': 1, 'GAGGGGCTAAACATGTGATT149': 1,
             'GATAAGTGAAGTTCATTGGT174': 1, 'GCAAAATATAGACAGGAGCT215': 1,
             'GCAAAGTCCAGTGTTACGGT150': 1, 'GCACCCCACAGTAAAAGGGA22': 1,
             'GCATAAGTGGAGAGGATTTT84': 1, 'GCGACGGGCATACGTCAATT27': 1,
             'GCTCTGGCACAGGGAGCAGG111': 1, 'GCTTGGGTAAGCAGTCACAA96': 1,
             'GGACAGATGGCTTATTTCTG106': 1, 'GGAGTCCGAGCTGTACGTGG204': 1,
             'GGCAGGTGGTGGAGGCAGAT15': 1, 'GGGTGTTACGTTGCTGCTTT151': 1,
             'GGTGAATGAGCGTCAGCTAA124': 1, 'GGTGTACTTGTGTCATAAAA199': 1,
             'GGTGTCGAGGGCTATGTGCA109': 1, 'GGTGTTAGTGCTAGAAAGAC152': 1,
             'GTAAATCGTAGGCGAGGAAA28': 1, 'GTGCATACCTATGAGCGTTA193': 1,
             'GTGCTCGGCGAGCCGAGTCG121': 1, 'GTGGGTGAGGTGCCCTCTAG64': 1,
             'GTTAACATGCGCAAATAGCA101': 1, 'GTTAAGTGACACAAAGTTGA237': 1,
             'GTTCCACAGGCGCGGGACTA225': 1, 'TAAACAGGGAACCAGGATCA12': 1,
             'TAAGATCGGCCTTAACGGTC44': 1, 'TAAGCTGTGTTCCCGTCTAT127': 1,
             'TAGAACGGGGAAAGTCGAAT18': 1, 'TAGAAGGAGAGCCGGCTGGC234': 1,
             'TAGGATGGGATCCTTATGGA117': 1, 'TAGTATAGGGTGTTGGAATA38': 1,
             'TATAATAGTCGCAAACGATG73': 1, 'TATAGCCAGCGTGTCTCTTG184': 1,
             'TATGGTGCTAGACCACTTAT58': 1, 'TATTATCAAGGAAGGCGGGG1': 1,
             'TCAGGTCCGTGAGTTTAGGC181': 1, 'TCGGATTCTGCTCTTGGTTA94': 1,
             'TCTGCTTGACGAGGACGCGG146': 1, 'TGCACAACTTAATGGTTTGG35': 1,
             'TGTTGGTGATGCTGCGCGCT59': 1, 'TTCCAGCAGGGCGAGGCGGG239': 1,
             'TTCGAGTGTAGGTTTGGTAA7': 1, 'TTGCACCCGCCGAGCCACGG103': 1},
            ('Control', 'Bean'):
            {'AAACGATTGGGTTTAGTCGA55': 1, 'AAAGATCCAGGGGTATTTAT115': 1,
             'AAATTGGGTGGTGGAAAGGT201': 1, 'AACGGGTAGAACTGGAATCA145': 1,
             'AAGCGGACGACGCGGGCAGA85': 1, 'AAGTAATACTCCGGTTATAC33': 1,
             'AATTGATGAGATTTGGAAGA140': 1, 'ACATACTTAGACCCCGGAAG177': 1,
             'ACCGGTAGGAAAACACCGAC70': 1, 'AGACTTCGACGAGGAGGGGC91': 1,
             'AGAGAGTCACCGACAGGCAG187': 1, 'AGAGCGCATTGGTTGGGCTA45': 1,
             'AGCCAGTGGTAACAACATTT108': 1, 'AGCGGGATACGAGTACAGTT220': 1,
             'AGCTGGAGGTGTATAATAGC13': 1, 'AGCTTAGTTGTGGCAGTCGT154': 1,
             'AGGGGTTCGGGAACGTGTGA241': 1, 'AGGTTTGATTGGTGCAACCT87': 1,
             'AGTACTCACAGGCGTCTTGA69': 1, 'AGTGCAAGCTCCGCGTTGCC169': 1,
             'AGTGGATATTACTAACACGG71': 1, 'ATAAGTGATCGGACGGAGTT166': 1,
             'ATGGGAAGATGCGTTGGCGG138': 1, 'ATTACGAGCCGTGGTGTGTG128': 1,
             'CACCTATCAAGAGTCAGGAT47': 1, 'CACTAGGGGGCGGACAGCTA230': 1,
             'CACTGACGTCATATAGTTGA161': 1, 'CAGGATCAGCCTGACAATTT209': 1,
             'CAGTACGGGAGGGTAAAAAG79': 1, 'CCATTGTGGGTAGTTCGGAC88': 1,
             'CCCGCGGGATATGCTATTGG123': 1, 'CGACGCGGGGCGGAAGAAGA46': 1,
             'CGGATCGGGCGAGGGCCTTT240': 1, 'CGGCCACGGCGTGAGAGTGT11': 1,
             'CGGGGGTGCCTGCAATTTCC67': 1, 'CGGGTAGTAGGAGCGCCAGG100': 1,
             'CGGTAGGGGTTGTGAGCAAC60': 1, 'CGGTGGTTTGGGGGATATCG41': 1,
             'CGTACGACCCGGGGCGACGT36': 1, 'CGTATAATGACGGGAACCGT232': 1,
             'CGTCTGGATGTGAGCGATGA163': 1, 'CGTTCTTTTGAAAGCCGTAT37': 1,
             'CTAAAGTGGGCCGCTTAGTG90': 1, 'CTAGTAATTTAAGTACCCAG219': 1,
             'CTATTCTGTTCTGGGGGTAT17': 1, 'CTGGCTGTGGCGGTTCGGAG39': 1,
             'CTGTTAGATTCCACTAGGTC156': 1, 'CTTACATGCTCTTACATTTG205': 1,
             'CTTAGGGATTGCATGGAGTG217': 1, 'CTTGAGGGGGATATTTACAG57': 1,
             'GAAAAGCGTTGCAATTTAAG4': 1, 'GAATACGATCGTGTTCCATG192': 1,
             'GAATGACGATTCTTGATTCG182': 1, 'GACCGGAGGTATGTCCATAT208': 1,
             'GACCTGAAGATGTACTAAGG81': 1, 'GAGCCTATCTACAGGGGTTG14': 1,
             'GAGGGCTTTTGTCGACGATA110': 1, 'GATTAGCGATAACGGATAGA176': 1,
             'GCAGGTGAATGGCTGGGTGT25': 1, 'GCCAACGTTACATTATTCCG203': 1,
             'GCCGGCATCGAGGCTGGAGC132': 1, 'GCCGTGAGTAGGGGTCATGC120': 1,
             'GCGACGGGCATACGTCAATT27': 1, 'GCGACTCGAGTTTAGAGTGT159': 1,
             'GCGGCATACGGTTGCAGGCC231': 1, 'GCGGTGGCGAAGCACATGAA113': 1,
             'GCTGAGACAGGTAGTAAGAC236': 1, 'GCTGTTGATTAACCGATGGC213': 1,
             'GGAACCTACATGGAGTGGTG224': 1, 'GGAGGAATGTGTTATGGATC29': 1,
             'GGAGTCCGAGCTGTACGTGG204': 1, 'GGATCGTGGCCAATGGAATC34': 1,
             'GGATGACTATTAACAGGCGT180': 1, 'GGCAGATCATGTGCTGGTAG211': 1,
             'GGCTGGTCCCTATGAGGCAC10': 1, 'GGGATATGCTATAGTAGGGG222': 1,
             'GGGCGATGTAAAGGCAACGC126': 1, 'GGTACTCGAGTGCAGCGGGT53': 1,
             'GGTAGCGGAGTGTTGGGAAT186': 1, 'GGTCGTATACCCGTTAGCGC200': 1,
             'GGTGAATGAGCGTCAGCTAA124': 1, 'GGTGGTGGTCTGTTATTGTT3': 1,
             'GGTGTGGCTCCCCGGAGGGG191': 1, 'GGTTTTAGGGGATCCGACCA92': 1,
             'GTACGGAGCATGGGACAACA172': 1, 'GTAGAATAGAGGGGACCTAG75': 1,
             'GTAGTCTGTATGAGGAGATA83': 1, 'GTGAGCGCGATAGACACCGC155': 1,
             'GTGCAGTGGTTCCGTGGTCC135': 1, 'GTGCTCGGCGAGCCGAGTCG121': 1,
             'GTGGGTGGCTGGGACGATGG202': 1, 'GTGGTCTATGTGCCGAATTA242': 1,
             'GTGTGATAGCAGCATGGAAA207': 1, 'GTTCCACAGGCGCGGGACTA225': 1,
             'TAAAACCGGTGGCATCGTTT107': 1, 'TAAGCTGTGTTCCCGTCTAT127': 1,
             'TAATGGCGGAGGAGTGACTG165': 1, 'TACAGAAGGGATTGTAAGAA227': 1,
             'TACGGTCAGGGTAATCGGTC171': 1, 'TAGCTACCGGGGAGGTCAGA50': 1,
             'TAGGATAGTAGAGGCCAGTT142': 1, 'TAGTATAGGGTGTTGGAATA38': 1,
             'TAGTGCTTAAATGTGATGAA148': 1, 'TATGGTGCTAGACCACTTAT58': 1,
             'TATTATCAAGGAAGGCGGGG1': 1, 'TCCTGTGGAAGATAGAGAGG26': 1,
             'TCGCGGACAGGAATAGGTTC114': 1, 'TCGGCGAACCTGGGGTTGCT228': 1,
             'TCGGCGGGGGGCGGAAGCTT179': 1, 'TCGTATTGCCGCTAGCTGCG104': 1,
             'TCTAATCAAGTTAGGTAGTG65': 1, 'TCTAGAGCGCGGCTTGGGGT212': 1,
             'TCTCTGGAACCATGAGAGCC16': 1, 'TCTGTCGCGGCAGTGCGGTA20': 1,
             'TGCAGTGTTCCGCGGGGTTG168': 1, 'TGGCAGCATTTAGTGAGTTG56': 1,
             'TGGGACTTGCAATGCAATGA24': 1, 'TGGTAGCGATCGTTGCGGGG189': 1,
             'TGTGCGCGTGTGTATAAGTT8': 1, 'TTATCGTGTGCTGGGCACCC78': 1,
             'TTCAGACGTGGAGTGAAATG105': 1, 'TTCGGATGGGGTCCTAGGAA98': 1,
             'TTCGGTTTGGGGTGGTGGGG144': 1, 'TTCTGATTGTGCGTTATGAG61': 1,
             'TTGCACCCGCCGAGCCACGG103': 1, 'TTGCACGAACGAACGACGGC136': 1,
             'TTGGCGTCGTTAGAGAGTAC143': 1, 'TTTACACGCTGCTTGTTGGA32': 1,
             'TTTTCAGCTACGGTCAAAAG238': 1, 'TTTTTTCGGCCGGAGGGAGT6': 1},
            ('Control', 'Cowpea'):
            {'AACAGAGTCTGAGGCTACGT9': 1, 'AAGCGGACGACGCGGGCAGA85': 1,
             'ACCAGTTGCGTCCGGGGGAC178': 1, 'ACGTCAAGGCACCCGCGGGA196': 1,
             'ACTATGAGGCGTTTCCGGCC72': 1, 'AGAGCGCATTGGTTGGGCTA45': 1,
             'AGCTGGAGGTGTATAATAGC13': 1, 'AGTACTCACAGGCGTCTTGA69': 1,
             'AGTGGCTGCGTCGTTACGTT51': 1, 'ATATCTAGCGTATCGGCGCG102': 1,
             'ATCGAGTTCGGCGTATGTAA119': 1, 'ATCTCAGAGTTGGTGAAGCA235': 1,
             'CAAAATGGCAAGTTATATCA125': 1, 'CAACAGGTGTCGAATGAGAA183': 1,
             'CACATCGGAACTCGCCGTAA89': 1, 'CAGGCTGGATAAGGGCATGG129': 1,
             'CCCGATTCGGCTCCTAATGA40': 1, 'CCGTTAGGAACGGTACGTAT0': 1,
             'CCTCGCCAGTAACCCCTTCT233': 1, 'CGAACCTTAACGAAAGGGCA80': 1,
             'CGACGCGGGGCGGAAGAAGA46': 1, 'CGAGGTGGGCGGGCTGTTTG52': 1,
             'CGGGCGGATGAGCGTTACCA214': 1, 'CGGGGTTACGTATAGTATGG76': 1,
             'CGGTGGTTTGGGGGATATCG41': 1, 'CTCTAAGAACCGAAGCATAT23': 1,
             'CTGAATGGCTGGGGTTACCC157': 1, 'GAACCCTAGGAGGTAACCAA206': 1,
             'GAGGGCGCGGTATTATGCGA49': 1, 'GAGTGAACTGTGTCCTTGTG43': 1,
             'GCAAAATATAGACAGGAGCT215': 1, 'GCATATGGGGTCGTAGACTG31': 1,
             'GCCGGCATCGAGGCTGGAGC132': 1, 'GCGCGTAATCGCGAAATAAC134': 1,
             'GCGTTCAGATATCTGGGTAG223': 1, 'GGAGTGGCTCCGGGGGGGTC97': 1,
             'GGGGTGGCGGGGTGAGGGCG226': 1, 'GGTAGAAACAAGGAATACCG77': 1,
             'GGTGTCGAGGGCTATGTGCA109': 1, 'GGTTTTAGGGGATCCGACCA92': 1,
             'GTGAGCGCGATAGACACCGC155': 1, 'GTGCTCGGCGAGCCGAGTCG121': 1,
             'GTTAACATGCGCAAATAGCA101': 1, 'GTTAAGTGACACAAAGTTGA237': 1,
             'GTTCGCTATACAGAGTGTAC82': 1, 'TAAGCTTCAGTGCTGGCGTT93': 1,
             'TAATTATTCGACCAGGCTTT216': 1, 'TAGAACGGGGAAAGTCGAAT18': 1,
             'TAGGATGGGATCCTTATGGA117': 1, 'TAGTATAGGGTGTTGGAATA38': 1,
             'TATAGCCAGCGTGTCTCTTG184': 1, 'TATGGTGCTAGACCACTTAT58': 1,
             'TATTATCAAGGAAGGCGGGG1': 1, 'TCAGGTCCGTGAGTTTAGGC181': 1,
             'TCTGGGGGGGTTTAGTCTTC229': 1, 'TGCCATAGCCCCAAGGCTAT160': 1,
             'TGCGGTCGATTCGCAGTGCC164': 1, 'TGTTGGTGATGCTGCGCGCT59': 1,
             'TTCGAGTGTAGGTTTGGTAA7': 1, 'TTCGTACTAACGCTTAAAAG68': 1,
             'TTGAACACGGGGGGCGTGGA188': 1, 'TTGGCGTCGTTAGAGAGTAC143': 1},
            ('Cowpea', 'Bean'):
            {'AAGCATGGGAAGTAGTTCTT86': 1, 'AATGGAAGGGGAAACAGAGG95': 1,
             'ACTGTGTAAAGTACAGTGCG197': 1, 'AGAAACCTAATTTGGTAAAC118': 1,
             'CCTGGCAAGCATGAGTGTTT54': 1, 'CGCCCGGGACACATGTGTCG162': 1,
             'CTTCTACCCGGTTGTACTTG195': 1, 'GAGGGGCTAAACATGTGATT149': 1,
             'GAGTGTAGGTAGTCCATACT198': 1, 'GGTGTACTTGTGTCATAAAA199': 1,
             'GTCCGCCGCAGGCGTAGCGA141': 1, 'GTTGTCGCCGTAGCCAGGCT147': 1,
             'TCTGGGGGGGTTTAGTCTTC229': 1},
            ('Cowpea', 'Control'):
            {'AACAGAGTCTGAGGCTACGT9': 1, 'AAGCATGGGAAGTAGTTCTT86': 1,
             'AAGCGGACGACGCGGGCAGA85': 1, 'ACCAGTTGCGTCCGGGGGAC178': 1,
             'ACGTCAAAGGAGGACGTCAG130': 1, 'ACGTCAAGGCACCCGCGGGA196': 1,
             'ACTATGAGGCGTTTCCGGCC72': 1, 'ACTGTGTAAAGTACAGTGCG197': 1,
             'AGACTTCGACGAGGAGGGGC91': 1, 'AGAGCGCATTGGTTGGGCTA45': 1,
             'AGCGAGATAGGTTGCGGATC5': 1, 'AGGAAATGGCAATGAAGGGC116': 1,
             'AGGGGTTCGGGAACGTGTGA241': 1, 'AGGTTTGATTGGTGCAACCT87': 1,
             'AGTACTCACAGGCGTCTTGA69': 1, 'ATTATTTTCGAGTTGGGACT112': 1,
             'CACATCGGAACTCGCCGTAA89': 1, 'CACTAGGGGGCGGACAGCTA230': 1,
             'CGAGGTGGGCGGGCTGTTTG52': 1, 'CGCGATCTATGCTGTCTTGT173': 1,
             'CGGGCGGATGAGCGTTACCA214': 1, 'CGGGTCCCTCTAGTGTAGGA133': 1,
             'CGGTGGTTTGGGGGATATCG41': 1, 'CTTAGGGATTGCATGGAGTG217': 1,
             'GAACCCTAGGAGGTAACCAA206': 1, 'GAAGTGGGCTTCGACAACTT99': 1,
             'GAGACTAGGCCACGCCCCGG137': 1, 'GAGTGTAGGTAGTCCATACT198': 1,
             'GATAAGTGAAGTTCATTGGT174': 1, 'GATAGGCGCGGGCACGTTTG122': 1,
             'GCCAGGAGTGCTCGGCGGGG210': 1, 'GCGACGGGCATACGTCAATT27': 1,
             'GCGGGGATCAATCCGGCCAG185': 1, 'GCGTTCAGATATCTGGGTAG223': 1,
             'GGCAGGTGGTGGAGGCAGAT15': 1, 'GGGATCGAACCTTATTTGGG175': 1,
             'GGGCTAGGGAAGCCTGCCTC131': 1, 'GGTAGAAACAAGGAATACCG77': 1,
             'GGTGTACTTGTGTCATAAAA199': 1, 'GGTTTTAGGGGATCCGACCA92': 1,
             'GTAGCGTTCCGAGACTACCA153': 1, 'GTGCTCGGCGAGCCGAGTCG121': 1,
             'TAGTATAGGGTGTTGGAATA38': 1, 'TCAGATACTAGGCGCAACGC221': 1,
             'TCAGGTCCGTGAGTTTAGGC181': 1, 'TCTGGGGGGGTTTAGTCTTC229': 1,
             'TTCGAGTGTAGGTTTGGTAA7': 1, 'TTGCGCATCTTGAGAAATCG194': 1,
             'TTTTCAGCTACGGTCAAAAG238': 1}}
        self.counts = biom2pandas(get_data_path('diffAbundance/counts.biom'))
        self.taxonomy = pd.read_csv(
            get_data_path('diffAbundance/taxonomy.tsv'),
            sep='\t', index_col=0, header=None).iloc[:, 0]
        self.metadata = pd.read_csv(
            get_data_path('diffAbundance/metadata.tsv'), sep='\t', index_col=0)

    def test_plot_diff_taxa(self):
        f = plot_diff_taxa(self.counts,
                           self.metadata['intervention'],
                           self.diffTaxa,
                           self.taxonomy,
                           min_mean_abundance=0.001)
        file_dummy = mkstemp('.png')[1]
        f.savefig(file_dummy, bbox_inches='tight')
        res = compare_images(
            get_data_path('diffAbundance/plot_difftaxa.png'),
            file_dummy,
            file_image_diff='./diff.diffAbundance.plot_difftaxa.png')
        if res[0] is True:
            remove(file_dummy)
        return res[0]


if __name__ == '__main__':
    main()
